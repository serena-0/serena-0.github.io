name: Update Frontier

on:
  # 定时：每 6 小时跑一次（UTC）
  schedule:
    - cron: "0 */6 * * *"
  # 手动触发
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-frontier:
    runs-on: ubuntu-latest

    steps:
      # 1) 拉代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2) Python 环境
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3) 安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser python-dateutil

      # 4) 生成 Frontier（新 + 热）
      - name: Build frontier (hot items)
        run: |
          python scripts/update_frontier.py

      # 5) DeepSeek AI 摘要 + 标签
      - name: AI summarize via DeepSeek
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          DEEPSEEK_MODEL: deepseek-chat
          DEEPSEEK_BASE_URL: https://api.deepseek.com
        run: |
          python scripts/ai_summarize_deepseek.py

      # 6) 提交并推送更新
      - name: Commit & push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git status
          git add data/frontier.json
          git commit -m "chore(frontier): update hot items & AI summaries" || echo "No changes to commit"
          git push
